/*!
 * splitview-vue v0.1.0
 * (c) 2020-2021 ChaosLee
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["splitview-vue"]=t()}(this,(function(){"use strict";const e=4*window.screen.width;const t={display:"block",top:"0",left:"0",position:"relative",width:"100%",height:"100%",overflow:"hidden",border:"none",padding:"0",margin:"0"},i={display:"block",position:"absolute",overflow:"hidden"},n={display:"block",overflow:"visible",top:"0",left:"0",position:"absolute","z-index":"1"},o={display:"block",position:"absolute","transition-property":"background-color","transition-duration":"0.2s","transition-delay":"0.1s","user-select":"none"},r=window,s=document,c=Math;function u(){return s.createElement("div")}function a(e,t){e.className=t}function l(e,t,i){e.addEventListener(t,i)}function d(e,t,i){e.removeEventListener(t,i)}function m(e,t){const i=new Event(e,{bubbles:!0});return i.data=t,i}function h(e,t,i){return c.max(c.min(i,t),e)}function p(e,t){for(const i in t)e.style.setProperty(i,t[i],"important")}const f={row:{p:"clientX",cSS:"height",cSO:"top",sS:"width",sO:"left",oS:"offsetWidth",o:"offsetLeft",sCV:"col-resize"},column:{p:"clientY",cSS:"width",cSO:"left",sS:"height",sO:"top",oS:"offsetHeight",o:"offsetTop",sCV:"row-resize"}},w=e=>e._size,v=e=>e.min;function b(e,t,i){let n=0;return e.each(t,(e=>n+=i(e))),n}const g={1:function(e){const t=e[0];return{direction:1,pulled:t,limit:{pull:t.max,push:b(t,1,v)},origin:{pull:t.size,push:b(t,1,w)}}},0:function(e){const t=e;return{direction:0,pulled:t,limit:{pull:t.max,push:b(t,0,v)},origin:{pull:t.size,push:b(t,0,w)}}}};function z(e,t){return c.trunc(c.abs(e-t))}function S(e){const t=x({max:0,min:0},e),i=new Object(t);return i.view=null,i}function x(e,t){const n=u(),f=u();function w(e,t){const{limit:i,origin:n,pulled:o,direction:r}=t;o.size=c.min(i.pull,n.pull+n.push-i.push,n.pull+e);let s=o.size-n.pull;o.each(r,(e=>{const t=e._size-s>e.min?s:e._size-e.min;e.size=e._size-t,s-=t}))}a(f,"sv-view"),a(n,"sv-handler"),p(f,i),function(e){p(e,o)}(n);let v=!1;function b(){const e=S[9]&&t[9],i=v&&!t[9],o=e||i;p(n,{"background-color":o?"#007fd4":null}),p(s.body,{cursor:o?t.axis.sCV:"default"})}l(n,"mouseover",(()=>v=!0)),l(n,"mouseout",(()=>v=!1)),l(n,"mousedown",(function(e){const{axis:i}=t,n=e[i.p];p(s.body,{cursor:i.sCV}),S[9]=t[9]=!0,t.snapshot();const o={1:g[1](S),0:g[0](S)};function u(e){const r=e[i.p]-n;t.restore(),0!==r&&w(c.abs(r),o[r>0?1:0])}l(r,"mousemove",u),l(r,"mouseup",(function e(){d(r,"mousemove",u),d(r,"mouseup",e),S[9]=t[9]=!1,b()}))})),l(n,"mouseover",b),l(n,"mouseout",b),l(n,"dblclick",(function(){n.dispatchEvent(m("request-reset",S.view))}));const S={9:!1,_size:0,0:null,1:null,get min(){return e.min},get max(){return e.max},get resizable(){return e.max!==e.min},get eView(){return f},get eHandler(){return n},get size(){return f[t.axis.oS]+.01},get o(){return f[t.axis.o]},set size(e){e=c.trunc(e),S.size!==e&&(p(f,{[t.axis.sS]:`${e}px`}),S.each(1,(e=>e[8]())),f.dispatchEvent(m("view-size-change",S.view)))},each(e,t){let i=S[e];for(;null!==i&&null!==i[e];)t(i),i=i[e]},8(){const{axis:e}=t,i=c.trunc(S[0].o+S[0].size);p(f,{[e.sO]:`${i}px`}),p(n,{[e.sO]:i-2+"px "})},relayout(){const{axis:e}=t;p(f,{[e.cSS]:"100%",[e.cSO]:"0"}),p(n,{[e.cSS]:"100%",[e.cSO]:"0",[e.sS]:"4px",display:S[0].resizable?"block":"none"}),S.size=S.min},view:Object.seal({get container(){return t[7]},get element(){return f},get previousSibling(){return S[0].view},get nextSibling(){return S[1].view},get size(){return c.trunc(S.size)},setSize(e){if("number"!=typeof e)throw new Error("A view size MUST be a number.");const i=h(S.min,S.max,e);if(!t[9]){if(0===z(i,S.size))return 0;t.snapshot();const e=i-S.size;if(w(c.abs(e),g[e>0?1:0](S[1])),0!==z(i,S.size)){const e=i-S.size;w(c.abs(e),g[e>0?0:1](S))}}return z(i,S.size)}})};return S}function y(){const i=u(),o=u();a(i,"sv-container"),a(o,"sv-handler-container"),p(i,t),function(e){p(e,n)}(o),i.appendChild(o);let s=null;function l(){clearTimeout(s);const e=[];y[0].each(1,(t=>e.push(t))),e.sort(((e,t)=>e.max-e.min-(t.max-t.min)));const t=e.reduce(((t,i,n)=>{const o=e.slice(n).reduce(((e,t)=>e+t.size),0),r=c.round(i.size/o*t),s=h(i.min,i.max,r);return i.size=s,t-s}),i[y.axis.oS]);y[0].each(1,(e=>e[8]())),0!==t&&(s=setTimeout((()=>console.warn(`Splitview: free ${t}px`)),1e3))}let d=null;function w(){null!==i.parentElement&&(p(o,{[y.axis.cSS]:"100%",[y.axis.sS]:"0"}),y[0].each(1,(e=>e.relayout())),l())}function v(e){y[1][0][1]=e,e[0]=y[1][0],e[1]=y[1],y[1][0]=e,i.appendChild(e.eView),o.appendChild(e.eHandler)}function b(e){e[0][1]=e[1],e[1][0]=e[0],e[1]=e[0]=null,i.removeChild(e.eView),o.removeChild(e.eHandler)}function g(e){if(e.container!==y[7])throw new Error("The view does NOT belongs to this container.")}const z=new WeakMap,y={9:!1,axis:f.row,direction:"row",0:null,1:null,snapshot(){y[0].each(1,(e=>e._size=e.size))},restore(){y[0].each(1,(e=>e.size=e._size))},7:Object.seal({get resizing(){return y[9]},set direction(e){if("row"!==e&&"column"!==e)throw new Error("A direction MUST be `row` or `column`.");e!==y.direction&&(y.direction=e,y.axis=f[e],w())},get direction(){return y.direction},get element(){return i},get firstView(){return y[0][1].view},get lastView(){return y[1][0].view},get viewList(){const e=[];return y[0].each(1,(t=>e.push(t.view))),e},mount(e){e.appendChild(i),w(),function(){let e=i.offsetWidth,t=i.offsetHeight;!function n(){const o=i.offsetWidth,s=i.offsetHeight;e===o&&t===s||(l(),i.dispatchEvent(m("container-size-change",y[7]))),e=o,t=s,d=r.requestAnimationFrame(n)}()}()},destroy(){i.parentElement.removeChild(i),cancelAnimationFrame(d)},relayout:w,appendView:e=>(g(e),v(z.get(e)),w(),e),removeView(e){g(e);const t=z.get(e);if(void 0===t)throw new Error("The view is NOT in container.");return b(t),w(),e},insertBefore(e,t=null){if(g(e),null===t)v(z.get(t));else{if(t.container!==y[7])throw new Error("The reference view does NOT belongs to this container.");null!==e.previousSibling&&b(z.get(e));const n=z.get(e),r=z.get(t);n[1]=r,n[0]=r[0],r[0][1]=n,r[0]=n,i.insertBefore(n.eView,r.eView),o.insertBefore(n.eHandler,r.eHandler)}return w(),e},createView(t={}){if("object"!=typeof t)throw new Error("An options MUST be an object.");const i=x(function(t){const i={min:50,max:e},{min:n=i.min,max:o=i.max}=t;if(n<0||!isFinite(n))throw new Error("A min MUST be >= 0 and finity.");if(o<n)throw new Error("A max MUST >= the min and finity.");return i.min=n,i.max=o,i}(t),y);return z.set(i.view,i),i.view}})};return y[0]=S(y),y[1]=S(y),y[0][1]=y[1],y[1][0]=y[0],y[7]}const E={width:"100%",height:"100%"},_=/^(row|column)$/,T={render(e){return e("div",{class:"sv-vue",style:E},this.$slots.default)},name:"sv-container",computed:{container(){return this._container}},beforeCreate(){const e=this._container=y();e.element.addEventListener("container-size-change",(t=>{t.stopPropagation(),this.$emit("resize",e)})),e.element.addEventListener("request-reset",(t=>{t.stopPropagation(),this.$emit("reset",e)}))},watch:{direction(){this.commitDirection()}},methods:{commitDirection(){this._container.direction=this.direction}},props:{direction:{type:String,default:"row",validator:e=>_.test(e)}},mounted(){this._container.mount(this.$el),this.commitDirection()},destroyed(){this._container.destroy()}};function $(e){return!isNaN(Number(e))}const V={render(e){return e("div",{style:E},this.$slots.default)},computed:{viewOptions(){return{min:Number(this.min),max:Number(this.max)}}},watch:{value(e){this._view.container.resizing||this.setSize(Number(e))}},methods:{setSize(e){if("number"!=typeof e)throw new Error("A view size MUST be a number.");const t=this._view.setSize(e);return this.$emit("input",this._view.size),t}},mounted(){const e=this.$parent._container.createView(this.viewOptions);e.element.addEventListener("view-size-change",(()=>{this.$emit("input",e.size),this.$emit("resize",e)})),this._view=e,this._view.element.appendChild(this.$el),this.$parent._container.appendView(this._view),null!==this.init&&this.$nextTick((()=>this.setSize(Number(this.init))))},destroyed(){this.$parent._container.removeView(this._view)},beforeCreate(){if("sv-container"!==this.$parent.$options.name)throw new Error("A `sv-view` parent MUST be a `sv-container`.")},props:{min:{type:[Number,String],default:50,validator:$},max:{type:[Number,String],default:4*window.screen.width,validator:$},init:{type:[Number,String,null],default:null,validator:$},value:{type:[Number,String],default:50}}};return{install(e){e.component("sv-container",T),e.component("sv-view",V)}}}));
